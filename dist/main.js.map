{"version":3,"file":"main.js","sources":["../src/abiParser.js","../src/stateOutput.js","../src/transactionOutput.js","../src/main.js"],"sourcesContent":["import _ from 'lodash'\n\nexport const filterAbiFunctions = (abi, opts = {}) => {\n  const { isConstant, hasInputs } = opts\n  let filterPred = (fn) => {\n    if (fn.type !== 'function') {\n      return false\n    }\n    if (isConstant !== undefined && fn.constant !== isConstant) {\n      return false\n    }\n    if (hasInputs !== undefined) {\n      if (hasInputs === true && (!fn.inputs || fn.inputs.length === 0)) {\n        return false\n      }\n      if (hasInputs === false && fn.inputs && fn.inputs.length > 0) {\n        return false\n      }\n    }\n    return true\n  }\n  return _.filter(abi, filterPred)\n}\n\nexport const constantFunctionNames = (abi) => {\n  return _.map(filterAbiFunctions(abi, { isConstant: true }), o => o.name)\n}\n\nexport const transactionFunctionNames = (abi) => {\n  return _.map(filterAbiFunctions(abi, { isConstant: false }), o => o.name)\n}\n\nexport const getOutputType = (abi, fnName) => {\n  return _.find(abi, { name: fnName }).outputs[0].type\n}\n","import _ from 'lodash'\n\nfunction underline (str) {\n  return _.map(str, () => {\n    return '-'\n  }).join('')\n}\n\nfunction formatVal (val) {\n  if (val && val.address) {\n    val = `(\n      Address: ${val.address}\n      Balance: ${val.balance}\n    )`\n  }\n  return val\n}\n\nfunction outputProps (props) {\n  return _.map(props, (val, prop) => {\n    val = formatVal(val)\n    return `    ${prop}: ${val}`\n  }).join('\\n')\n}\n\nexport default (name, address, balance, props) => {\n  return `\n  ${name}\n  ${underline(name)}\n  Address:     ${address}\n  Balance:     ${balance}\n  Props:\n${outputProps(props)}\n`\n}\n","import _ from 'lodash'\n\nfunction logEvents (events) {\n  const evtsStr = _.map(events, (e) => {\n    const argsStr = _.map(e.args, (val, param) => {\n      return `    ${param}: ${val}\\n`\n    }).join('')\n    return `\n  ${e.event} (\n${argsStr}  )\n`\n  }).join('')\n\n  return `\n  Events\n  ------\n  ${evtsStr}`\n}\n\nexport default (tx) => {\n  return logEvents(tx.logs)\n}\n","/* global web3 */\n\nimport _ from 'lodash'\nimport {\n  filterAbiFunctions,\n  transactionFunctionNames\n} from './abiParser'\nimport stateOutput from './stateOutput.js'\nimport transactionOutput from './transactionOutput.js'\n\nfunction getBalance (address) {\n  return web3.eth.getBalance(address).toNumber()\n}\n\nasync function contractState (contractInstance) {\n  const fns = filterAbiFunctions(contractInstance.abi, {\n    isConstant: true,\n    hasInputs: false\n  })\n  const results = await Promise.all(_.map(fns, (fn) => {\n    return contractInstance[fn.name].call()\n  }))\n  let props = {}\n  for (let i = 0; i < fns.length; i++) {\n    let result = results[i]\n    if (fns[i].outputs && fns[i].outputs[0] && fns[i].outputs[0].type === 'address') {\n      result = {\n        address: result,\n        balance: getBalance(result)\n      }\n    }\n    props[fns[i].name] = result\n  }\n  const balance = getBalance(contractInstance.address)\n  const { address } = contractInstance\n  const { contract_name: name } = contractInstance.constructor._json\n\n  return {\n    balance,\n    props,\n    output: () => stateOutput(name, address, balance, props)\n  }\n}\n\nfunction wrapTxFunction (contractInstance, fnName) {\n  const txFn = contractInstance[fnName]\n  return async function () {\n    let tx = await txFn.apply(this, Array.prototype.slice.call(arguments))\n    return _.assign(\n      tx,\n      { output: () => transactionOutput(tx) }\n    )\n  }\n}\n\nfunction transactionFns (contractInstance) {\n  const txFnNames = transactionFunctionNames(contractInstance.abi)\n  let txFns = {}\n  _.forEach(txFnNames, (fnName) => {\n    txFns[fnName] = wrapTxFunction(contractInstance, fnName)\n  })\n  return txFns\n}\n\nfunction wrapContractInstance (contractInstance) {\n  return _.assign(\n    contractInstance,\n    transactionFns(contractInstance),\n    { state: async () => contractState(contractInstance) }\n  )\n}\n\nfunction wrapContractFn (fn) {\n  return async function () {\n    const c = await fn.apply(this, Array.prototype.slice.call(arguments))\n    return wrapContractInstance(c)\n  }\n}\n\nfunction wrapContractArtifact (contractArtifact) {\n  _.forEach(['new', 'at'], (fnName) => {\n    contractArtifact[fnName] = wrapContractFn(contractArtifact[fnName])\n  })\n  return contractArtifact\n}\n\nexport function requireContract (contractArtifact) {\n  return wrapContractArtifact(contractArtifact)\n}\n"],"names":["filterAbiFunctions","abi","opts","isConstant","hasInputs","filterPred","fn","type","undefined","constant","inputs","length","_","filter","transactionFunctionNames","map","o","name","underline","str","join","formatVal","val","address","balance","outputProps","props","prop","logEvents","events","evtsStr","e","argsStr","args","param","event","tx","logs","contractInstance","fns","results","Promise","all","call","i","result","outputs","getBalance","constructor","_json","contract_name","stateOutput","contractState","web3","eth","toNumber","wrapTxFunction","fnName","txFn","apply","Array","prototype","slice","arguments","assign","output","transactionOutput","transactionFns","txFnNames","txFns","forEach","wrapContractInstance","state","wrapContractFn","c","wrapContractArtifact","contractArtifact","requireContract"],"mappings":"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"}