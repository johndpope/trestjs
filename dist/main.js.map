{"version":3,"file":"main.js","sources":["../src/abiParser.js","../src/stateOutput.js","../src/transactionOutput.js","../src/main.js"],"sourcesContent":["import _ from 'lodash'\n\nexport const constantFunctionNames = (abi) => {\n  return _.map(_.filter(abi, { type: 'function', constant: true }), o => o.name)\n}\n\nexport const transactionFunctionNames = (abi) => {\n  return _.map(_.filter(abi, { type: 'function', constant: false }), o => o.name)\n}\n\nexport const getOutputType = (abi, fnName) => {\n  return _.find(abi, { name: fnName }).outputs[0].type\n}\n","import _ from 'lodash'\n\nfunction underline (str) {\n  return _.map(str, () => {\n    return '-'\n  }).join('')\n}\n\nfunction outputProps (props) {\n  return _.map(props, (val, prop) => {\n    return `    ${prop}: ${val}`\n  }).join('\\n')\n}\n\nexport default (name, address, balance, props) => {\n  return `\n  ${name}\n  ${underline(name)}\n  Address:     ${address}\n  Balance:     ${balance}\n  Props:\n${outputProps(props)}\n`\n}\n","import _ from 'lodash'\n\nfunction logEvents (events) {\n  const evtsStr = _.map(events, (e) => {\n    const argsStr = _.map(e.args, (val, param) => {\n      return `    ${param}: ${val}\\n`\n    }).join('')\n    return `\n  ${e.event} (\n${argsStr}  )\n`\n  }).join('')\n\n  return `\n  Events\n  ------\n  ${evtsStr}`\n}\n\nexport default (tx) => {\n  return logEvents(tx.logs)\n}\n","/* global web3 */\n\nimport _ from 'lodash'\nimport {\n  constantFunctionNames,\n  transactionFunctionNames\n} from './abiParser'\nimport stateOutput from './stateOutput.js'\nimport transactionOutput from './transactionOutput.js'\n\nasync function contractState (contractInstance) {\n  const fnNames = constantFunctionNames(contractInstance.abi)\n  const results = await Promise.all(_.map(fnNames, (fnName) => {\n    return contractInstance[fnName].call()\n  }))\n  let props = {}\n  for (let i = 0; i < fnNames.length; i++) {\n    props[fnNames[i]] = results[i]\n  }\n  const balance = web3.eth.getBalance(contractInstance.address).toNumber()\n  const { address } = contractInstance\n  const { contract_name: name } = contractInstance.constructor._json\n\n  return {\n    balance,\n    props,\n    output: () => stateOutput(name, address, balance, props)\n  }\n}\n\nfunction wrapTxFunction (contractInstance, fnName) {\n  const txFn = contractInstance[fnName]\n  return async function () {\n    let tx = await txFn.apply(this, Array.prototype.slice.call(arguments))\n    return _.assign(\n      tx,\n      { output: () => transactionOutput(tx) }\n    )\n  }\n}\n\nfunction transactionFns (contractInstance) {\n  const txFnNames = transactionFunctionNames(contractInstance.abi)\n  let txFns = {}\n  _.forEach(txFnNames, (fnName) => {\n    txFns[fnName] = wrapTxFunction(contractInstance, fnName)\n  })\n  return txFns\n}\n\nfunction wrapContractInstance (contractInstance) {\n  return _.assign(\n    contractInstance,\n    transactionFns(contractInstance),\n    { state: async () => contractState(contractInstance) }\n  )\n}\n\nfunction newContractFn (newFn) {\n  return async function () {\n    const c = await newFn.apply(this, Array.prototype.slice.call(arguments))\n    return wrapContractInstance(c)\n  }\n}\n\nfunction wrapContractArtifact (contractArtifact) {\n  contractArtifact.new = newContractFn(contractArtifact.new)\n  return contractArtifact\n}\n\nexport function requireContract (contractArtifact) {\n  return wrapContractArtifact(contractArtifact)\n}\n"],"names":["constantFunctionNames","abi","_","map","filter","type","constant","o","name","transactionFunctionNames","underline","str","join","outputProps","props","val","prop","address","balance","logEvents","events","evtsStr","e","argsStr","args","param","event","tx","logs","contractInstance","fnNames","results","Promise","all","fnName","call","i","length","web3","eth","getBalance","toNumber","constructor","_json","contract_name","stateOutput","contractState","wrapTxFunction","txFn","apply","Array","prototype","slice","arguments","assign","output","transactionOutput","transactionFns","txFnNames","txFns","forEach","wrapContractInstance","state","newContractFn","newFn","c","wrapContractArtifact","contractArtifact","new","requireContract"],"mappings":"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"}