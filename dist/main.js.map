{"version":3,"file":"main.js","sources":["../src/abiParser.js","../src/stateOutput.js","../src/transactionOutput.js","../src/main.js"],"sourcesContent":["import _ from 'lodash'\n\nexport const filterAbiFunctions = (abi, opts = {}) => {\n  const { isConstant, hasInputs } = opts\n  let filterPred = (fn) => {\n    if (fn.type !== 'function') {\n      return false\n    }\n    if (isConstant !== undefined && fn.constant !== isConstant) {\n      return false\n    }\n    if (hasInputs !== undefined) {\n      if (hasInputs === true && (!fn.inputs || fn.inputs.length === 0)) {\n        return false\n      }\n      if (hasInputs === false && fn.inputs && fn.inputs.length > 0) {\n        return false\n      }\n    }\n    return true\n  }\n  return _.filter(abi, filterPred)\n}\n\nexport const constantFunctionNames = (abi) => {\n  return _.map(filterAbiFunctions(abi, { isConstant: true }), o => o.name)\n}\n\nexport const transactionFunctionNames = (abi) => {\n  return _.map(filterAbiFunctions(abi, { isConstant: false }), o => o.name)\n}\n\nexport const getOutputType = (abi, fnName) => {\n  return _.find(abi, { name: fnName }).outputs[0].type\n}\n","import _ from 'lodash'\n\nfunction underline (str) {\n  return _.map(str, () => {\n    return '-'\n  }).join('')\n}\n\nfunction outputProps (props) {\n  return _.map(props, (val, prop) => {\n    return `    ${prop}: ${val}`\n  }).join('\\n')\n}\n\nexport default (name, address, balance, props) => {\n  return `\n  ${name}\n  ${underline(name)}\n  Address:     ${address}\n  Balance:     ${balance}\n  Props:\n${outputProps(props)}\n`\n}\n","import _ from 'lodash'\n\nfunction logEvents (events) {\n  const evtsStr = _.map(events, (e) => {\n    const argsStr = _.map(e.args, (val, param) => {\n      return `    ${param}: ${val}\\n`\n    }).join('')\n    return `\n  ${e.event} (\n${argsStr}  )\n`\n  }).join('')\n\n  return `\n  Events\n  ------\n  ${evtsStr}`\n}\n\nexport default (tx) => {\n  return logEvents(tx.logs)\n}\n","/* global web3 */\n\nimport _ from 'lodash'\nimport {\n  filterAbiFunctions,\n  transactionFunctionNames\n} from './abiParser'\nimport stateOutput from './stateOutput.js'\nimport transactionOutput from './transactionOutput.js'\n\nasync function contractState (contractInstance) {\n  const fnNames = _.map(filterAbiFunctions(contractInstance.abi, {\n    isConstant: true,\n    hasInputs: false\n  }), fn => fn.name)\n  const results = await Promise.all(_.map(fnNames, (fnName) => {\n    return contractInstance[fnName].call()\n  }))\n  let props = {}\n  for (let i = 0; i < fnNames.length; i++) {\n    props[fnNames[i]] = results[i]\n  }\n  const balance = web3.eth.getBalance(contractInstance.address).toNumber()\n  const { address } = contractInstance\n  const { contract_name: name } = contractInstance.constructor._json\n\n  return {\n    balance,\n    props,\n    output: () => stateOutput(name, address, balance, props)\n  }\n}\n\nfunction wrapTxFunction (contractInstance, fnName) {\n  const txFn = contractInstance[fnName]\n  return async function () {\n    let tx = await txFn.apply(this, Array.prototype.slice.call(arguments))\n    return _.assign(\n      tx,\n      { output: () => transactionOutput(tx) }\n    )\n  }\n}\n\nfunction transactionFns (contractInstance) {\n  const txFnNames = transactionFunctionNames(contractInstance.abi)\n  let txFns = {}\n  _.forEach(txFnNames, (fnName) => {\n    txFns[fnName] = wrapTxFunction(contractInstance, fnName)\n  })\n  return txFns\n}\n\nfunction wrapContractInstance (contractInstance) {\n  return _.assign(\n    contractInstance,\n    transactionFns(contractInstance),\n    { state: async () => contractState(contractInstance) }\n  )\n}\n\nfunction wrapContractFn (fn) {\n  return async function () {\n    const c = await fn.apply(this, Array.prototype.slice.call(arguments))\n    return wrapContractInstance(c)\n  }\n}\n\nfunction wrapContractArtifact (contractArtifact) {\n  _.forEach(['new', 'at'], (fnName) => {\n    contractArtifact[fnName] = wrapContractFn(contractArtifact[fnName])\n  })\n  return contractArtifact\n}\n\nexport function requireContract (contractArtifact) {\n  return wrapContractArtifact(contractArtifact)\n}\n"],"names":["filterAbiFunctions","abi","opts","isConstant","hasInputs","filterPred","fn","type","undefined","constant","inputs","length","_","filter","transactionFunctionNames","map","o","name","underline","str","join","outputProps","props","val","prop","address","balance","logEvents","events","evtsStr","e","argsStr","args","param","event","tx","logs","contractInstance","fnNames","results","Promise","all","fnName","call","i","web3","eth","getBalance","toNumber","constructor","_json","contract_name","stateOutput","contractState","wrapTxFunction","txFn","apply","Array","prototype","slice","arguments","assign","output","transactionOutput","transactionFns","txFnNames","txFns","forEach","wrapContractInstance","state","wrapContractFn","c","wrapContractArtifact","contractArtifact","requireContract"],"mappings":";;;;;;;;AAEO,MAAMA,qBAAqB,SAArBA,kBAAqB,CAACC,GAAD,EAAoB;MAAdC,IAAc,uEAAP,EAAO;QAC5CC,UAD4C,GAClBD,IADkB,CAC5CC,UAD4C;QAChCC,SADgC,GAClBF,IADkB,CAChCE,SADgC;;MAEhDC,aAAcC,EAAD,IAAQ;QACnBA,GAAGC,IAAH,KAAY,UAAhB,EAA4B;aACnB,KAAP;;QAEEJ,eAAeK,SAAf,IAA4BF,GAAGG,QAAH,KAAgBN,UAAhD,EAA4D;aACnD,KAAP;;QAEEC,cAAcI,SAAlB,EAA6B;UACvBJ,cAAc,IAAd,KAAuB,CAACE,GAAGI,MAAJ,IAAcJ,GAAGI,MAAH,CAAUC,MAAV,KAAqB,CAA1D,CAAJ,EAAkE;eACzD,KAAP;;UAEEP,cAAc,KAAd,IAAuBE,GAAGI,MAA1B,IAAoCJ,GAAGI,MAAH,CAAUC,MAAV,GAAmB,CAA3D,EAA8D;eACrD,KAAP;;;WAGG,IAAP;GAfF;SAiBOC,EAAEC,MAAF,CAASZ,GAAT,EAAcI,UAAd,CAAP;CAnBK;;AAsBP;;AAIA,AAAO,MAAMS,2BAA4Bb,GAAD,IAAS;SACxCW,EAAEG,GAAF,CAAMf,mBAAmBC,GAAnB,EAAwB,EAAEE,YAAY,KAAd,EAAxB,CAAN,EAAsDa,KAAKA,EAAEC,IAA7D,CAAP;CADK;;AC1BP,SAASC,SAAT,CAAoBC,GAApB,EAAyB;SAChBP,EAAEG,GAAF,CAAMI,GAAN,EAAW,MAAM;WACf,GAAP;GADK,EAEJC,IAFI,CAEC,EAFD,CAAP;;;AAKF,SAASC,WAAT,CAAsBC,KAAtB,EAA6B;SACpBV,EAAEG,GAAF,CAAMO,KAAN,EAAa,CAACC,GAAD,EAAMC,IAAN,KAAe;WACzB,OAAMA,IAAK,KAAID,GAAI,EAA3B;GADK,EAEJH,IAFI,CAEC,IAFD,CAAP;;;AAKF,mBAAe,CAACH,IAAD,EAAOQ,OAAP,EAAgBC,OAAhB,EAAyBJ,KAAzB,KAAmC;SACxC;IACNL,IAAK;IACLC,UAAUD,IAAV,CAAgB;iBACHQ,OAAQ;iBACRC,OAAQ;;EAEvBL,YAAYC,KAAZ,CAAmB;CANnB;CADF;;ACZA,SAASK,SAAT,CAAoBC,MAApB,EAA4B;QACpBC,UAAUjB,EAAEG,GAAF,CAAMa,MAAN,EAAeE,CAAD,IAAO;UAC7BC,UAAUnB,EAAEG,GAAF,CAAMe,EAAEE,IAAR,EAAc,CAACT,GAAD,EAAMU,KAAN,KAAgB;aACpC,OAAMA,KAAM,KAAIV,GAAI,IAA5B;KADc,EAEbH,IAFa,CAER,EAFQ,CAAhB;WAGQ;IACRU,EAAEI,KAAM;EACVH,OAAQ;CAFN;GAJc,EAQbX,IARa,CAQR,EARQ,CAAhB;;SAUQ;;;IAGNS,OAAQ,EAHV;;;AAMF,yBAAgBM,EAAD,IAAQ;SACdR,UAAUQ,GAAGC,IAAb,CAAP;CADF;;;+BCTA,WAA8BC,gBAA9B,EAAgD;UACxCC,UAAU1B,EAAEG,GAAF,CAAMf,mBAAmBqC,iBAAiBpC,GAApC,EAAyC;kBACjD,IADiD;iBAElD;KAFS,CAAN,EAGZ;aAAMK,GAAGW,IAAT;KAHY,CAAhB;UAIMsB,UAAU,MAAMC,QAAQC,GAAR,CAAY7B,EAAEG,GAAF,CAAMuB,OAAN,EAAe,UAACI,MAAD,EAAY;aACpDL,iBAAiBK,MAAjB,EAAyBC,IAAzB,EAAP;KADgC,CAAZ,CAAtB;QAGIrB,QAAQ,EAAZ;SACK,IAAIsB,IAAI,CAAb,EAAgBA,IAAIN,QAAQ3B,MAA5B,EAAoCiC,GAApC,EAAyC;YACjCN,QAAQM,CAAR,CAAN,IAAoBL,QAAQK,CAAR,CAApB;;UAEIlB,UAAUmB,KAAKC,GAAL,CAASC,UAAT,CAAoBV,iBAAiBZ,OAArC,EAA8CuB,QAA9C,EAAhB;UACQvB,OAbsC,GAa1BY,gBAb0B,CAatCZ,OAbsC;UAcvBR,IAduB,GAcdoB,iBAAiBY,WAAjB,CAA6BC,KAdf,CActCC,aAdsC;;;WAgBvC;aAAA;WAAA;cAGG;eAAMC,YAAYnC,IAAZ,EAAkBQ,OAAlB,EAA2BC,OAA3B,EAAoCJ,KAApC,CAAN;;KAHV;;;kBAhBa+B;;;;;;;;;AARf,AA+BA,SAASC,cAAT,CAAyBjB,gBAAzB,EAA2CK,MAA3C,EAAmD;QAC3Ca,OAAOlB,iBAAiBK,MAAjB,CAAb;2BACO,aAAkB;QACnBP,KAAK,MAAMoB,KAAKC,KAAL,CAAW,IAAX,EAAiBC,MAAMC,SAAN,CAAgBC,KAAhB,CAAsBhB,IAAtB,CAA2BiB,SAA3B,CAAjB,CAAf;WACOhD,EAAEiD,MAAF,CACL1B,EADK,EAEL,EAAE2B,QAAQ;eAAMC,kBAAkB5B,EAAlB,CAAN;OAAV,EAFK,CAAP;GAFF;;;AASF,SAAS6B,cAAT,CAAyB3B,gBAAzB,EAA2C;QACnC4B,YAAYnD,yBAAyBuB,iBAAiBpC,GAA1C,CAAlB;MACIiE,QAAQ,EAAZ;IACEC,OAAF,CAAUF,SAAV,EAAsBvB,MAAD,IAAY;UACzBA,MAAN,IAAgBY,eAAejB,gBAAf,EAAiCK,MAAjC,CAAhB;GADF;SAGOwB,KAAP;;;AAGF,SAASE,oBAAT,CAA+B/B,gBAA/B,EAAiD;SACxCzB,EAAEiD,MAAF,CACLxB,gBADK,EAEL2B,eAAe3B,gBAAf,CAFK,EAGL,EAAEgC;oCAAO;eAAYhB,cAAchB,gBAAd,CAAZ;OAAP;;;;;QAAF,EAHK,CAAP;;;AAOF,SAASiC,cAAT,CAAyBhE,EAAzB,EAA6B;2BACpB,aAAkB;UACjBiE,IAAI,MAAMjE,GAAGkD,KAAH,CAAS,IAAT,EAAeC,MAAMC,SAAN,CAAgBC,KAAhB,CAAsBhB,IAAtB,CAA2BiB,SAA3B,CAAf,CAAhB;WACOQ,qBAAqBG,CAArB,CAAP;GAFF;;;AAMF,SAASC,oBAAT,CAA+BC,gBAA/B,EAAiD;IAC7CN,OAAF,CAAU,CAAC,KAAD,EAAQ,IAAR,CAAV,EAA0BzB,MAAD,IAAY;qBAClBA,MAAjB,IAA2B4B,eAAeG,iBAAiB/B,MAAjB,CAAf,CAA3B;GADF;SAGO+B,gBAAP;;;AAGF,AAAO,SAASC,eAAT,CAA0BD,gBAA1B,EAA4C;SAC1CD,qBAAqBC,gBAArB,CAAP;;;;;"}